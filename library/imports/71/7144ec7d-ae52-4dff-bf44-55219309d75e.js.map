{"version":3,"sources":["assets/script/framework/virtualList/VirtualList.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,iDAA4C;AAEtC,IAAA,KAAqF,EAAE,CAAC,UAAU,EAAhG,OAAO,aAAA,EAAE,QAAQ,cAAA,EAAE,gBAAgB,sBAAA,EAAE,iBAAiB,uBAAA,EAAE,gBAAgB,sBAAA,EAAE,IAAI,UAAkB,CAAC;AAEzG;;GAEG;AACH,IAAY,YAGX;AAHD,WAAY,YAAY;IACpB,+CAAI,CAAA;IACJ,mDAAM,CAAA;AACV,CAAC,EAHW,YAAY,GAAZ,oBAAY,KAAZ,oBAAY,QAGvB;AAED;;GAEG;AAEH;IAAA;QAMW,YAAO,GAAY,IAAI,CAAC;QAMxB,iBAAY,GAAiB,YAAY,CAAC,MAAM,CAAC;QAOjD,mBAAc,GAAc,IAAI,CAAC;QAOjC,iBAAY,GAAY,IAAI,CAAC;QAEP,YAAO,GAAY,KAAK,CAAC;IAC1D,CAAC;IAvBG;QALC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;YACb,OAAO,EAAE,MAAM,IAAI,QAAQ;YAC3B,OAAO,gBAAK,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;SACtC,CAAC;sDAC6B;IAM/B;QAJC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC;YAC3B,OAAO,EAAE,MAAM,IAAI,UAAU;SAChC,CAAC;2DACsD;IAOxD;QALC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,MAAM;YACf,OAAO,EAAE,MAAM,IAAI,WAAW;YAC9B,OAAO,gBAAK,OAAO,IAAI,CAAC,YAAY,KAAK,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC;SAClE,CAAC;6DACsC;IAOxC;QALC,QAAQ,CAAC;YACN,IAAI,EAAE,EAAE,CAAC,IAAI;YACb,OAAO,EAAE,MAAM,IAAI,UAAU;YAC7B,OAAO,gBAAK,OAAO,IAAI,CAAC,YAAY,KAAK,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;SAChE,CAAC;2DACkC;IAEd;QAArB,QAAQ,CAAC,EAAE,CAAC,OAAO,CAAC;sDAAiC;IA5B7C,iBAAiB;QAD7B,OAAO,CAAC,mBAAmB,CAAC;OAChB,iBAAiB,CA6B7B;IAAD,wBAAC;CA7BD,AA6BC,IAAA;AA7BY,8CAAiB;AA+B9B;;GAEG;AAMH;IAAyC,+BAAY;IAArD;QAAA,qEAiIC;QA/HU,UAAI,GAAsB,IAAI,iBAAiB,EAAE,CAAC;QAGlD,YAAM,GAAwB,EAAE,CAAC;QAMjC,iBAAW,GAAY,IAAI,CAAC;QAE3B,iBAAW,GAAkB,IAAI,CAAC;QAClC,aAAO,GAAkB,IAAI,CAAC;;IAmH1C,CAAC;IAjHa,4BAAM,GAAhB;QACI,IAAI,SAAS,EAAE;YACX,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,OAAO;SACV;QAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;QACpD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,YAAY,CAAC,uBAAa,CAAC,CAAC;QACpE,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,IAAI,CAAC,OAAO,CAAC,IAAI,GAAG,IAAI,CAAC;YACzB,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;SACzB;IACL,CAAC;IAES,mCAAa,GAAvB;QACI,IAAI,SAAS,EAAE;YACX,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,OAAO;SACV;IACL,CAAC;IAED;;OAEG;IACK,gCAAU,GAAlB;QACI,IAAI,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,MAAM,GAAG,UAAU,CAAC,OAAO,CAAC,YAAY,CAAC,uBAAa,CAAC,CAAC;QAE5D,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACpB,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,UAAU,CAAC,OAAO,CAAC;YACvC,IAAI,CAAC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;SAC5B;QACD,IAAI,CAAC,MAAM,EAAE;YACT,UAAU,CAAC,OAAO,CAAC,YAAY,CAAC,uBAAa,CAAC,CAAC;SAClD;IACL,CAAC;IAED;;;;;;;OAOG;IACI,sCAAgB,GAAvB,UAAwB,GAAW,EAAE,UAA6B,EAAE,UAA6B,EAAE,CAAa,EAAE,CAAiB;QAA9F,2BAAA,EAAA,aAAsB,EAAE,CAAC,EAAE,EAAE;QAAE,2BAAA,EAAA,aAAsB,EAAE,CAAC,EAAE,EAAE;QAAE,kBAAA,EAAA,KAAa;QAAE,kBAAA,EAAA,QAAiB;QAC/H,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,EAAE,UAAU,EAAE,UAAU,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACrG,CAAC;IAED;;OAEG;IACI,gCAAU,GAAjB;QACI,OAAO,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC;IAChC,CAAC;IAED;;;;OAIG;IACI,2BAAK,GAAZ,UAAa,KAAa;;QAAE,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,6BAAc;;QACtC,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,KAAK,2BAAC,KAAK,GAAK,IAAI,GAAE;IACvC,CAAC;IAED;;;OAGG;IACI,0BAAI,GAAX;;QAAY,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QACtB,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,IAAI,WAAI,IAAI,EAAE;IAC/B,CAAC;IAED;;OAEG;IACI,yBAAG,GAAV;QACI,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;IACvB,CAAC;IAEM,8BAAQ,GAAf;QACI,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;IAC5B,CAAC;IAED;;;OAGG;IACI,6BAAO,GAAd;;QAAe,cAAc;aAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;YAAd,yBAAc;;QACzB,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,OAAO,WAAI,IAAI,EAAE;IAClC,CAAC;IAED;;OAEG;IACI,2BAAK,GAAZ;QACI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;IACzB,CAAC;IAED;;OAEG;IACI,4BAAM,GAAb,UAAc,KAAa,EAAE,WAAoB;;QAAE,iBAAmB;aAAnB,UAAmB,EAAnB,qBAAmB,EAAnB,IAAmB;YAAnB,gCAAmB;;QAClE,CAAA,KAAA,IAAI,CAAC,OAAO,CAAA,CAAC,MAAM,2BAAC,KAAK,EAAE,WAAW,GAAK,OAAO,GAAE;IACxD,CAAC;IAED;;;OAGG;IACI,0BAAI,GAAX,UAAY,IAAoC;QAC5C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC5B,CAAC;IA9HD;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,OAAO,EAAE,MAAM,IAAI,OAAO,EAAE,CAAC;6CACT;IAGzD;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,iBAAiB,EAAE,OAAO,EAAE,MAAM,IAAI,yCAAyC,EAAE,CAAC;+CAC5D;IAMxC;QAJC,QAAQ,CAAC;YACN,OAAO,EAAE,KAAK;YACd,OAAO,EAAE,MAAM,IAAI,6CAA6C;SAClE,CAAC;oDACgC;IAXlB,WAAW;QAL/B,OAAO;QACP,gBAAgB;QAChB,iBAAiB;QACjB,gBAAgB,CAAC,EAAE,CAAC,UAAU,CAAC;QAC/B,IAAI,CAAC,4BAA4B,CAAC;OACd,WAAW,CAiI/B;IAAD,kBAAC;CAjID,AAiIC,CAjIwC,EAAE,CAAC,SAAS,GAiIpD;kBAjIoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["import VirtualLayout from \"./VirtualLayout\";\n\nconst { ccclass, property, requireComponent, executeInEditMode, disallowMultiple, menu } = cc._decorator;\n\n/**\n * 列表元素模板类型\n */\nexport enum TemplateType {\n    NODE,\n    PREFAB\n}\n\n/**\n * 虚拟列表容器以及容器内元素的模板数据\n */\n@ccclass('VirtualLayoutData')\nexport class VirtualLayoutData {\n    @property({\n        type: cc.Node,\n        tooltip: CC_DEV && '列表容器节点',\n        visible() { return !this._isMain; }\n    })\n    public Content: cc.Node = null;\n\n    @property({\n        type: cc.Enum(TemplateType),\n        tooltip: CC_DEV && '列表元素模板类型'\n    })\n    public TemplateType: TemplateType = TemplateType.PREFAB;\n\n    @property({\n        type: cc.Prefab,\n        tooltip: CC_DEV && '列表元素模板预制体',\n        visible() { return this.TemplateType === TemplateType.PREFAB; }\n    })\n    public TemplatePrefab: cc.Prefab = null;\n\n    @property({\n        type: cc.Node,\n        tooltip: CC_DEV && '列表元素模板节点',\n        visible() { return this.TemplateType === TemplateType.NODE; }\n    })\n    public TemplateNode: cc.Node = null;\n\n    @property(cc.Boolean) public _isMain: boolean = false;\n}\n\n/**\n * 虚拟列表\n */\n@ccclass\n@disallowMultiple\n@executeInEditMode\n@requireComponent(cc.ScrollView)\n@menu('Framework/UI组件/VirtualList')\nexport default class VirtualList extends cc.Component {\n    @property({ type: VirtualLayoutData, tooltip: CC_DEV && '列表主容器' })\n    public Main: VirtualLayoutData = new VirtualLayoutData();\n\n    @property({ type: VirtualLayoutData, tooltip: CC_DEV && '列表除主容器外的其他容器\\n需要分层显示时使用，一般用于降低draw call' })\n    public Others: VirtualLayoutData[] = [];\n\n    @property({ \n        visible: false,\n        tooltip: CC_DEV && '元素节点大小是否一致且固定不变，大小不定时更耗性能（目前不支持此选项，必须为true）'\n     })\n    public IsFixedSize: boolean = true;\n\n    private _scrollView: cc.ScrollView = null;\n    private _layout: VirtualLayout = null;\n\n    protected onLoad() {\n        if (CC_EDITOR) {\n            this._runEditor();\n            return;\n        }\n\n        this._scrollView = this.getComponent(cc.ScrollView);\n        this._layout = this._scrollView.content.getComponent(VirtualLayout);\n        if (this._layout) {\n            this._layout.list = this;\n            this._layout.onInit();\n        }\n    }\n\n    protected resetInEditor() {\n        if (CC_EDITOR) {\n            this._runEditor();\n            return;\n        }\n    }\n\n    /**\n     * 编辑器模式下的一些设置\n     */\n    private _runEditor() {\n        let scrollView = this.getComponent(cc.ScrollView);\n        let layout = scrollView.content.getComponent(VirtualLayout);\n\n        if (!this.Main.Content) {\n            this.Main.Content = scrollView.content;\n            this.Main._isMain = true;\n        }\n        if (!layout) {\n            scrollView.content.addComponent(VirtualLayout);\n        }\n    }\n\n    /**\n     * 滚动元素节点到view的指定位置\n     * @param idx 元素下标\n     * @param itemAnchor 元素的锚点位置（左下角为0点）\n     * @param viewAnchor view的锚点位置（左下角为0点）\n     * @param t 时间 s\n     * @param a 加速度是否衰减，为true且滚动距离大时滚动会不准确\n     */\n    public scrollItemToView(idx: number, itemAnchor: cc.Vec2 = cc.v2(), viewAnchor: cc.Vec2 = cc.v2(), t: number = 0, a: boolean = true) {\n        this._scrollView.scrollToOffset(this._layout.getScrollOffset(idx, itemAnchor, viewAnchor), t, a);\n    }\n\n    /**\n     * 获取列表数据\n     */\n    public getDataArr() {\n        return this._layout.dataArr;\n    }\n\n    /**\n     * 重置某个元素数据\n     * @param index \n     * @param args 元素所需参数\n     */\n    public reset(index: number, ...args: any[]) {\n        this._layout.reset(index, ...args);\n    }\n\n    /**\n     * 添加元素数据到尾部\n     * @param args 元素所需参数\n     */\n    public push(...args: any[]) {\n        this._layout.push(...args);\n    }\n\n    /**\n     * 删除尾部元素数据\n     */\n    public pop() {\n        this._layout.pop();\n    }\n\n    public clearAll(){\n        this._layout.clearAll();\n    }\n\n    /**\n     * 添加元素数据到头部\n     * @param args \n     */\n    public unshift(...args: any[]) {\n        this._layout.unshift(...args);\n    }\n\n    /**\n     * 删除头部元素数据\n     */\n    public shift() {\n        this._layout.shift();\n    }\n\n    /**\n     * 插入或删除元素 用法同数组splice\n     */\n    public splice(start: number, deleteCount?: number, ...argsArr: any[][]) {\n        this._layout.splice(start, deleteCount, ...argsArr);\n    }\n\n    /**\n     * 数据排序\n     * @param call \n     */\n    public sort(call: (a: any[], b: any[]) => number) {\n        this._layout.sort(call);\n    }\n}\n"]}