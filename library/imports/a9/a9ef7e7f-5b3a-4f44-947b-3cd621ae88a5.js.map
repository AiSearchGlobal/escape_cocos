{"version":3,"sources":["assets/script/framework/component/VMQrcode.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { ConfigModule } from \"../../userData/ConfigModule\";\nimport { QRCode } from \"../lib/Qrcode\";\nimport VMBase from \"./VMBase\";\n\nconst { ccclass, property, menu, executeInEditMode,help } = cc._decorator;\n\n/**\n *  [VM-Qrcode]\n *  绑定到一个锚点为（0，0）的空节点上，根据玩家id生成二维码\n */\n@ccclass\n@menu('ModelViewer/VM-Qrcode(二维码)')\nexport default class VMQrcode extends VMBase {\n    @property({type: cc.Node, tooltip:\"要生成二位码的节点，锚点必须是（0，0）\"})\n    nodeQr: cc.Node = null;\n\n    @property({\n        tooltip:'玩家id，用来绑定上下级用'\n    })\n    uidWatchPath: string = \"\";\n\n    start(){\n        if (CC_EDITOR) return;\n        \n        var url = ConfigModule.SHARE_URL;\n\n        if(this.uidWatchPath){\n            var uid = this.VM.getValue(this.uidWatchPath);\n            url += `?shangjiid=${uid}`;\n        }\n\n        var qrcode = new QRCode(-1, 2);\n        qrcode.addData(url);\n        qrcode.make();\n\n        var ctx = this.nodeQr.addComponent(cc.Graphics);\n\n        // compute tileW/tileH based on node width and height\n        var tileW = this.nodeQr.width / qrcode.getModuleCount();\n        var tileH = this.nodeQr.height / qrcode.getModuleCount();\n\n        // draw in the Graphics\n        for (var row = 0; row < qrcode.getModuleCount(); row++) {\n            for (var col = 0; col < qrcode.getModuleCount(); col++) {\n                // ctx.fillStyle = qrcode.isDark(row, col) ? options.foreground : options.background;\n                if (qrcode.isDark(row, col)) {\n                    ctx.fillColor = cc.Color.BLACK;\n                } else {\n                    ctx.fillColor = cc.Color.WHITE;\n                }\n                var w = (Math.ceil((col + 1) * tileW) - Math.floor(col * tileW));\n                var h = (Math.ceil((row + 1) * tileW) - Math.floor(row * tileW));\n                ctx.rect(Math.round(col * tileW), Math.round(row * tileH), w, h);\n                ctx.fill();\n            }\n        }\n    }\n}\n"]}