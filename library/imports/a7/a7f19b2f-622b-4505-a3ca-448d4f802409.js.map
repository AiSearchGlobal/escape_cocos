{"version":3,"sources":["assets/script/framework/adapter/abstract/ScrollAdapter.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,uCAAkF;AAElF,yCAAwC;AACxC,0DAAyD;AACzD,0DAAyD;AACzD,wDAAuD;AACvD,8DAA6D;AAC7D,4DAA2D;AAC3D,0DAAyD;AACzD,sDAAqD;AACrD,mCAAkC;AAClC,+BAA8B;AAC9B,0EAA0E;AACpE,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAE5C;IAAqD,iCAAY;IAAjE;QAAA,qEAkKC;QAjKG;;;WAGG;QACsB,mBAAa,GAAkB,IAAI,6BAAa,EAAE,CAAA;QAC3E;;;WAGG;QACoB,iBAAW,GAAmB,IAAI,yBAAW,EAAE,CAAA;QACtE;;;WAGG;QACsB,mBAAa,GAAkB,IAAI,6BAAa,EAAE,CAAA;QAC3E;;;WAGG;QACwB,qBAAe,GAAoB,IAAI,iCAAe,EAAE,CAAA;QACnF;;;WAGG;QACuB,oBAAc,GAAmB,IAAI,+BAAc,EAAE,CAAA;QAC/E;;;WAGG;QACsB,mBAAa,GAAkB,IAAI,6BAAa,EAAE,CAAA;QAC3E;;;WAGG;QACI,kBAAY,GAAoB,IAAI,2BAAY,EAAE,CAAA;;IA+H7D,CAAC;IAxHG;;;MAGE;IACK,mCAAW,GAAlB,UAAmB,OAAiB,EAAE,IAAO,IAAI,CAAC;IAClD;;;OAGG;IACI,+BAAO,GAAd;QACI,OAAO,IAAI,WAAW,CAAC,IAAI,CAAC,CAAA;IAChC,CAAC;IACD;;;OAGG;IACI,iCAAS,GAAhB,UAAiB,IAAa,EAAE,IAAY;QACxC,OAAO,IAAI,aAAa,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAA;IAC9C,CAAC;IAED,sBAAW,qCAAU;QADrB,aAAa;aACb;YACI,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,IAAI,kBAAW,CAAC,QAAQ,CAAA;QACjE,CAAC;;;OAAA;IAED,sBAAW,uCAAY;QADvB,aAAa;aACb;YACI,OAAO,IAAI,CAAC,aAAa,CAAC,WAAW,IAAI,kBAAW,CAAC,UAAU,CAAA;QACnE,CAAC;;;OAAA;IAED,sBAAW,6CAAkB;QAD7B,aAAa;aACb;YACI,OAAO,IAAI,CAAC,WAAW,CAAC,WAAW,IAAI,kBAAW,CAAC,KAAK,CAAA;QAC5D,CAAC;;;OAAA;IAED,sBAAW,mCAAQ;QADnB,qBAAqB;aACrB;YACI,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAA;QACtC,CAAC;;;OAAA;IAED,sBAAW,oCAAS;QADpB,sBAAsB;aACtB;YACI,OAAO,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAA;QACtC,CAAC;;;OAAA;IAED,sBAAW,8CAAmB;QAD9B,aAAa;aACb;YACI,IAAI,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;YACnC,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,GAAG,KAAK,CAAA;QACtD,CAAC;;;OAAA;IAED,sBAAW,uCAAY;QADvB,iBAAiB;aACjB;YACI,OAAO,eAAM,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;QACpF,CAAC;;;OAAA;IAED,sBAAW,wCAAa;QADxB,kBAAkB;aAClB;YACI,OAAO,eAAM,CAAC,SAAS,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACrF,CAAC;;;OAAA;IAED,sBAAW,qCAAU;QADrB,uBAAuB;aACvB;YACI,IAAI,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;YACzC,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,UAAU,CAAA;QAC7D,CAAC;;;OAAA;IAED,sBAAW,wCAAa;QADxB,4BAA4B;aAC5B;YACI,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAA;aAClF;iBAAM;gBACH,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAA;aAClF;QACL,CAAC;;;OAAA;IAED,sBAAW,wCAAa;QADxB,4BAA4B;aAC5B;YACI,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAA;aAClF;iBAAM;gBACH,OAAO,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAA;aAClF;QACL,CAAC;;;OAAA;IAED,sBAAW,0CAAe;QAD1B,sBAAsB;aACtB;YACI,IAAI,IAAI,CAAC,YAAY,EAAE;gBACnB,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAA;aACxD;iBAAM;gBACH,OAAO,IAAI,CAAC,WAAW,CAAC,GAAG,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAA;aACxD;QACL,CAAC;;;OAAA;IACD;;;;OAIG;IACI,wCAAgB,GAAvB,UAAwB,IAAa;QACjC,IAAI,IAAI,IAAI,IAAI;YAAE,OAAM;QACxB,IAAI,IAAI,YAAY,EAAE,CAAC,KAAK;YAAE,OAAM;QACpC,IAAI,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAA;QAChD,IAAI,OAAO,EAAE;YACT,OAAO,OAAO,CAAA;SACjB;QACD,OAAO,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;IAC7C,CAAC;IAES,iCAAS,GAAnB;QACI,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACxC,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACtC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACvC,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACzC,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QACxC,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QAC1C,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,CAAA;QAExC,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,CAAA;QAChC,IAAI,CAAC,cAAc,CAAC,aAAa,EAAE,CAAA;QACnC,IAAI,CAAC,aAAa,CAAC,aAAa,EAAE,CAAA;QAClC,IAAI,CAAC,eAAe,CAAC,aAAa,EAAE,CAAA;QACpC,IAAI,CAAC,aAAa,CAAC,aAAa,EAAE,CAAA;QAClC,IAAI,CAAC,aAAa,CAAC,aAAa,EAAE,CAAA;QAClC,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE,CAAA;IACrC,CAAC;IAES,8BAAM,GAAhB,UAAiB,SAAiB;QAC9B,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAA;QACjD,IAAI,CAAC,WAAW,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAA;QAC/C,IAAI,CAAC,aAAa,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAA;QACjD,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAA;IACtD,CAAC;IA5JwB;QAAxB,QAAQ,CAAC,6BAAa,CAAC;wDAAmD;IAKpD;QAAtB,QAAQ,CAAC,yBAAW,CAAC;sDAAgD;IAK7C;QAAxB,QAAQ,CAAC,6BAAa,CAAC;wDAAmD;IAKhD;QAA1B,QAAQ,CAAC,iCAAe,CAAC;0DAAyD;IAKzD;QAAzB,QAAQ,CAAC,+BAAc,CAAC;yDAAsD;IAKtD;QAAxB,QAAQ,CAAC,6BAAa,CAAC;wDAAmD;IA9BzD,aAAa;QADlC,OAAO;OACc,aAAa,CAkKlC;IAAD,oBAAC;CAlKD,AAkKC,CAlKoD,EAAE,CAAC,SAAS,GAkKhE;AAlKqB,sCAAa;AAmKnC;;;;;GAKG;AACH;IAAiC,+BAAI;IAArC;;IASA,CAAC;IARG,iBAAiB;IACP,+BAAS,GAAnB;QACI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAS,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IACnD,CAAC;IACD,iBAAiB;IACP,+BAAS,GAAnB;QACI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAS,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IACnD,CAAC;IACL,kBAAC;AAAD,CATA,AASC,CATgC,WAAI,GASpC;AATY,kCAAW;AAUxB;;;EAGE;AACF;IAAmC,iCAAM;IAAzC;;IAUA,CAAC;IATa,iCAAS,GAAnB;QACI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IAC7C,CAAC;IACS,iCAAS,GAAnB;QACI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IAC7C,CAAC;IACS,iCAAS,GAAnB;QACI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAW,CAAC,OAAO,EAAE,IAAI,CAAC,CAAA;IAC7C,CAAC;IACL,oBAAC;AAAD,CAVA,AAUC,CAVkC,eAAM,GAUxC;AAVY,sCAAa","file":"","sourceRoot":"/","sourcesContent":["import { ArrangeAxis, HolderEvent, Orientation, ViewEvent } from \"../define/enum\";\nimport { IElement } from \"../define/interface\";\nimport { Helper } from \"../help/helper\";\nimport { CenterManager } from \"../manager/CenterManager\";\nimport { LayoutManager } from \"../manager/LayoutManager\";\nimport { ModelManager } from \"../manager/ModelManager\";\nimport { PageViewManager } from \"../manager/PageViewManager\";\nimport { ReleaseManager } from \"../manager/ReleaseManager\";\nimport { ScrollManager } from \"../manager/ScrollManager\";\nimport { ViewManager } from \"../manager/ViewManager\";\nimport { Holder } from \"./Holder\";\nimport { View } from \"./View\";\n// import { _decorator, Component, Node, Size, Prefab, Color, } from 'cc';\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport abstract class ScrollAdapter<T = any> extends cc.Component {\n    /**\n     * 滚动管理器\n     * 负责滚动的逻辑，类似于ScrollView\n     */\n    @property(ScrollManager) scrollManager: ScrollManager = new ScrollManager()\n    /**\n     * 视图管理器\n     * 负责管理可视区域item的创建、回收、主轴方向布局等逻辑\n     */\n    @property(ViewManager) viewManager: ViewManager<T> = new ViewManager()\n    /**\n     * 布局管理器\n     * 负责交叉轴方向的布局逻辑\n     */\n    @property(LayoutManager) layoutManager: LayoutManager = new LayoutManager()\n    /**\n     * 分页管理器\n     * 负责处理分页逻辑\n     */\n    @property(PageViewManager) pageViewManager: PageViewManager = new PageViewManager()\n    /**\n     * 释放管理器\n     * 负责处理4个方向的 ”拉“ ”释放“ 等逻辑\n     */\n    @property(ReleaseManager) releaseManager: ReleaseManager = new ReleaseManager()\n    /**\n     * 居中管理器\n     * 除了负责自动居中以外，还负责通过索引计算滚动的具体位置\n     */\n    @property(CenterManager) centerManager: CenterManager = new CenterManager()\n    /**\n     * 数据管理器\n     * 负责数据的增删改查，对用户数据进行二次封装\n     */\n    public modelManager: ModelManager<T> = new ModelManager()\n    /**\n     * 获取预制体\n     * @param data 用户自定义数据\n     * @return 返回一个预制体\n     */\n    public abstract getPrefab(data: T): cc.Node | cc.Prefab\n    /** \n     * 初始化元素布局属性，子类可重写，默认为单列 \n     * 例如你想实现表格布局，你可以通过设置 element.wrapAfterMode、element.wrapBeforeMode来控制\n    */\n    public initElement(element: IElement, data: T) { }\n    /** \n     * 返回一个View实例\n     * 子类可重写\n     */\n    public getView(): View<T> {\n        return new DefaultView(this)\n    }\n    /** \n     * 返回一个Holder实例 \n     * 子类可重写\n     */\n    public getHolder(node: cc.Node, code: string): Holder<T> {\n        return new DefaultHolder(node, code, this)\n    }\n    /** 是否垂直滚动 */\n    public get isVertical() {\n        return this.scrollManager.orientation == Orientation.Vertical\n    }\n    /** 是否水平滚动 */\n    public get isHorizontal() {\n        return this.scrollManager.orientation == Orientation.Horizontal\n    }\n    /** 主轴排列方向 */\n    public get isArrangeAxisStart() {\n        return this.viewManager.arrangeAxis == ArrangeAxis.Start\n    }\n    /** 主轴方向 尺寸|坐标 key */\n    public get mainAxis() {\n        return this.isVertical ? \"y\" : \"x\"\n    }\n    /** 交叉轴方向 尺寸|坐标 key */\n    public get crossAxis() {\n        return this.isVertical ? \"x\" : \"y\"\n    }\n    /** 主轴方向锚点 */\n    public get mainAxisAnchorPoint() {\n        let point = this.isVertical ? 1 : 0\n        return this.isArrangeAxisStart ? point : 1 - point\n    }\n    /** 主轴方向可视区域尺寸 */\n    public get mainAxisSize() {\n        return Helper.sizeToVec(this.scrollManager.view.getContentSize())[this.mainAxis]\n    }\n    /** 交叉轴方向可视区域尺寸 */\n    public get crossAxisSize() {\n        return Helper.sizeToVec(this.scrollManager.view.getContentSize())[this.crossAxis]\n    }\n    /** 根据滑动方向和排列方向决定的乘积 */\n    public get multiplier() {\n        var multiplier = this.isVertical ? -1 : 1\n        return this.isArrangeAxisStart ? -multiplier : multiplier\n    }\n    /** 主轴方向 Header 的 padding */\n    public get paddingHeader() {\n        if (this.isHorizontal) {\n            return this.isArrangeAxisStart ? this.viewManager.left : this.viewManager.right\n        } else {\n            return this.isArrangeAxisStart ? this.viewManager.top : this.viewManager.bottom\n        }\n    }\n    /** 主轴方向 Footer 的 padding */\n    public get paddingFooter() {\n        if (this.isHorizontal) {\n            return this.isArrangeAxisStart ? this.viewManager.right : this.viewManager.left\n        } else {\n            return this.isArrangeAxisStart ? this.viewManager.bottom : this.viewManager.top\n        }\n    }\n    /** 主轴方向 padding 总和 */\n    public get mainAxisPadding() {\n        if (this.isHorizontal) {\n            return this.viewManager.left + this.viewManager.right\n        } else {\n            return this.viewManager.top + this.viewManager.bottom\n        }\n    }\n    /**\n     * 从父节点中递归获取 ScrollAdapter\n     * @param node 第一个获取ScrollAdapter的node\n     * @return 返回父节点中第一个找到的 ScrollAdapter\n     */\n    public getParentAdapter(node: cc.Node) {\n        if (node == null) return\n        if (node instanceof cc.Scene) return\n        var adapter = node.getComponent(\"ScrollAdapter\")\n        if (adapter) {\n            return adapter\n        }\n        return this.getParentAdapter(node.parent)\n    }\n\n    protected __preload() {\n        this.scrollManager.internal_create(this)\n        this.viewManager.internal_create(this)\n        this.modelManager.internal_create(this)\n        this.releaseManager.internal_create(this)\n        this.layoutManager.internal_create(this)\n        this.pageViewManager.internal_create(this)\n        this.centerManager.internal_create(this)\n\n        this.viewManager.internal_init()\n        this.releaseManager.internal_init()\n        this.layoutManager.internal_init()\n        this.pageViewManager.internal_init()\n        this.centerManager.internal_init()\n        this.scrollManager.internal_init()\n        this.modelManager.internal_init()\n    }\n\n    protected update(deltaTime: number) {\n        this.scrollManager.internal_lateUpdate(deltaTime)\n        this.viewManager.internal_lateUpdate(deltaTime)\n        this.layoutManager.internal_lateUpdate(deltaTime)\n        this.releaseManager.internal_lateUpdate(deltaTime)\n    }\n}\n/** \n * 默认View 如有特殊需求可重写\n * 可在任何地方通过this.adapter.node 来监听对应的事件\n * 一个 view 可以理解为单行容器，每个view容器内可包含多个 holder（例如表格布局）\n * 每个 view 所包含的 holder 个数是由用户逻辑来确定的，可通过 IElement里的换行来进行动态设置\n */\nexport class DefaultView extends View {\n    /** 当单行view显示时 */\n    protected onVisible(): void {\n        this.adapter.node.emit(ViewEvent.VISIBLE, this)\n    }\n    /** 当单行view隐藏时 */\n    protected onDisable(): void {\n        this.adapter.node.emit(ViewEvent.DISABLE, this)\n    }\n}\n/** \n * 默认Holder 如有特殊需求可重写 \n * 在item的自定义脚本中，可以通过this.node来监听对应的事件\n*/\nexport class DefaultHolder extends Holder {\n    protected onCreated(): void {\n        this.node.emit(HolderEvent.CREATED, this)\n    }\n    protected onVisible(): void {\n        this.node.emit(HolderEvent.VISIBLE, this)\n    }\n    protected onDisable(): void {\n        this.node.emit(HolderEvent.DISABLE, this)\n    }\n}"]}