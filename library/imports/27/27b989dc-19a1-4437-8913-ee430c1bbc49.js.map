{"version":3,"sources":["assets/script/network/Network.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Http } from \"./Http\";\nimport EventMng from \"../framework/manager/EventMng\";\nimport { ConfigModule } from \"../userData/ConfigModule\";\nimport UIHelp from \"../framework/ui/UIHelp\";\nimport GameDataCenter from \"../userData/GameDataCenter\";\nimport { Log, LOG_TAG } from \"../utils/Log\";\n\nexport class Network {\n    private _httpUrl: string;\n\n    constructor() {\n        if(ConfigModule.IS_TEST){\n            this._httpUrl = ConfigModule.HTTP_URL_TEST;\n        }else{\n            this._httpUrl = ConfigModule.HTTP_URL_DEV;\n        }\n    }\n\n    //http请求\n    httpSend(cmd, params, callback, loding) {\n        \n        var self = this;\n\n        if (loding) {\n            UIHelp.ShowLoding();\n        }\n\n        if (params && GameDataCenter.accountModel.jwt) {\n            params[\"jwt\"] = GameDataCenter.accountModel.jwt;\n        }\n\n        var param = this.obj_contact(params);\n        var url = encodeURI(self._httpUrl + \"/\" + cmd + param);\n\n        Log.logTag(LOG_TAG.HTTP, `%chttp发送: ${cmd}-->`,'color:#000;background:yellow', url);\n        \n        Http.get(url, function (eventName: string, xhr: XMLHttpRequest) {\n            UIHelp.CloseLoding();\n            if (eventName == 'COMPLETE') {\n                if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\n                    var response = JSON.parse(xhr.responseText)\n                    let replace = cmd.replace(/\\//g, '_')\n\n                    if (cc.sys.isNative) {\n                        Log.logTag(LOG_TAG.HTTP, `%chttp接收: ${replace}-->`,'color:#000;background:orange', JSON.stringify(response));\n                    } else {\n                        Log.logTag(LOG_TAG.HTTP, `%chttp接收: ${replace}-->`,'color:#000;background:orange', response);\n                    }\n\n                    if (response[\"errcode\"] != 0) {\n                        if(response[\"errcode\"] == \"1000\"){\n                            GameDataCenter.accountModel.jwt = \"\";\n                        }\n                        UIHelp.ShowTips(response[\"errmsg\"]);\n                        return;\n                    }\n\n                    callback && callback(response);\n                } else {\n                    UIHelp.ShowTips(\"服务器维护中\");\n                }\n            } else if (eventName == 'TIMEOUT') {\n                //TODO:添加提示连接网关超时\n                // this.et.emit('TIMEOUT', {})\n                Log.error(\"添加提示连接网关超时\")\n            } else if (eventName == 'ERROR') {\n                //TODO:添加提示连接网关发生错误\n                Log.error(\"添加提示连接网关发生错误\")\n            }\n        }, this);\n    }\n\n    public httpPost(url: string, params: any, callback: Function, loding) {//异步httppost\n        var self = this;\n        if (loding) {\n            UIHelp.ShowLoding();\n        }\n        \n        var surl;\n        surl = url;\n        if(GameDataCenter.accountModel.jwt){\n            surl = url + '?jwt=' + GameDataCenter.accountModel.jwt;\n        }\n\n        var urcl = encodeURI(self._httpUrl + \"/\" + surl);\n\n        Log.logTag(LOG_TAG.HTTP, `%chttp发送: ${url}-->`,'color:#000;background:yellow', urcl);\n        \n        Http.post(urcl, params, function (eventName: string, xhr: XMLHttpRequest) {\n            UIHelp.CloseLoding();\n            if (eventName == 'COMPLETE') {\n                if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\n                    var response = JSON.parse(xhr.responseText)\n                    let replace = url.replace(/\\//g, '_')\n\n                    if (cc.sys.isNative) {\n                        Log.logTag(LOG_TAG.HTTP, `%chttp接收: ${replace}-->`,'color:#000;background:orange', JSON.stringify(response));\n                    } else {\n                        Log.logTag(LOG_TAG.HTTP, `%chttp接收: ${replace}-->`,'color:#000;background:orange', response);\n                    }\n                    \n                    if (response[\"errcode\"] != 0) {\n                        UIHelp.ShowTips(response[\"errmsg\"]);\n                        return;\n                    }\n\n                    if(response.data.jwt){\n                        GameDataCenter.accountModel.jwt = response.data.jwt;\n                    }\n\n                    callback && callback(response);\n                }\n            } else if (eventName == 'TIMEOUT') {\n                //TODO:添加提示连接网关超时\n                this.et.emit('TIMEOUT', {})\n                Log.error(\"添加提示连接网关超时\")\n            } else if (eventName == 'ERROR') {\n                //TODO:添加提示连接网关发生错误\n                Log.error(\"添加提示连接网关发生错误\")\n            }\n        }, this);\n    }\n\n    public obj_contact(obj) {\n        var s = \"\";\n        for (var k in obj) {\n          let v = obj[k];\n          if (s.length == 0) {\n            s += \"?\" + k + \"=\" + v;\n          } else {\n            s += \"&\" + k + \"=\" + v;\n          }\n        }\n        return s;\n      }\n}"]}