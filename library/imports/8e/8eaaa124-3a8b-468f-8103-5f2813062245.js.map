{"version":3,"sources":["assets/script/framework/adapter/component/Indicator.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameEvent } from '../../../userData/EventConst';\nimport GameDataCenter from '../../../userData/GameDataCenter';\nimport EventMng from '../../manager/EventMng';\nimport { ScrollAdapter } from '../abstract/ScrollAdapter';\nimport { IndicatorMode } from '../define/enum';\nimport { PageViewManager } from '../manager/PageViewManager';\nconst { ccclass, property } = cc._decorator;\n/**\n * 简单Indicator示例\n * 如果你想要更多效果，请自行编写或扩展 Indicator\n */\n@ccclass\nexport class Indicator extends cc.Component {\n    @property(cc.Node) adapterNode: cc.Node = null\n    @property(cc.Node) tabNode: cc.Node = null\n    @property({\n        type: [cc.Node],\n    }) spriteNode: cc.Node[] = []\n    @property({ type: IndicatorMode }) indicatorMode: IndicatorMode = IndicatorMode.Normal\n    @property cellSize: cc.Size = new cc.Size(10, 10)\n    @property spacing: number = 10\n    private _indicators: cc.Node[] = []\n    private _layout: cc.Layout = null\n    private _color: cc.Color = new cc.Color()\n    private adapter: ScrollAdapter = null;\n\n    get layout() {\n        if (this._layout == null) {\n            this._layout = this.getComponent(cc.Layout) || this.addComponent(cc.Layout)\n            if (this.adapter.isHorizontal) {\n                this._layout.type = cc.Layout.Type.HORIZONTAL\n                this._layout.spacingX = this.spacing\n            } else {\n                this._layout.type = cc.Layout.Type.VERTICAL\n                this._layout.spacingY = this.spacing\n            }\n            this._layout.resizeMode = cc.Layout.ResizeMode.CONTAINER\n        }\n        return this._layout\n    }\n    protected __preload() {\n        this.adapter = this.adapterNode.getComponent(ScrollAdapter);\n        if (this.adapter) {\n            this.adapter.pageViewManager.on(PageViewManager.Event.ON_PAGE_LENGTH_CHANGED, this._onPageLengthChanged, this)\n            this.adapter.pageViewManager.on(PageViewManager.Event.ON_SCROLL_PAGE_END, this._onScrollPageEnd, this)\n        }\n    }\n\n    private _onScrollPageEnd() {\n        this.changedState()\n    }\n    private _onPageLengthChanged() {\n        if (!this.adapter) return\n        const indicators = this._indicators\n        const length = this.adapter.viewManager.groupLength\n        if (length === indicators.length) {\n            return\n        }\n        let i = 0\n        if (length > indicators.length) {\n            for (i = 0; i < length; ++i) {\n                if (!indicators[i]) {\n                    indicators[i] = this._createIndicator(i)\n                }\n            }\n        } else {\n            const count = indicators.length - length\n            for (i = count; i > 0; --i) {\n                const transform = indicators[i - 1]\n                this.node.removeChild(transform)\n                indicators.splice(i - 1, 1)\n            }\n        }\n        if (this.layout && this.layout.enabledInHierarchy) {\n            this.layout.updateLayout()\n        }\n        this.changedState()\n    }\n\n    private _createIndicator(index: any) {\n        const node = this.spriteNode[index];\n        // node.layer = this.node.layer\n        node.parent = this.node\n\n        if (this.indicatorMode == IndicatorMode.Button) {\n            var button = node.getComponent(cc.Button) || node.addComponent(cc.Button)\n            var event = new cc.Component.EventHandler()\n            event.component = \"Indicator\"\n            event.handler = \"_click\"\n            event.target = this.node\n            event.customEventData = index\n            button.clickEvents.push(event)\n        }\n        return node\n    }\n    private _click(event: any, data: any) {\n        this.adapter.pageViewManager.scrollToPage(this.adapter.pageViewManager.pageTurningSpeed, data)\n    }\n    public changedState() {\n        const indicators = this._indicators\n        if (indicators.length === 0 || !this.adapter) return\n        const idx = this.adapter.pageViewManager.currentIndex\n\n        EventMng.emit(GameEvent.RANK_TAB_CHANGE, idx);\n        if (idx >= indicators.length) return\n        this.tabNode.stopAllActions();\n        this.tabNode.runAction(cc.moveTo(0.1, cc.v2(indicators[idx].position.x, indicators[idx].position.y)));\n        \n        var account = GameDataCenter.accountModel;\n        account.myRankNum = idx == 0 ? account.thisRankNum : account.lastRankNum;\n        account.myRankNo = idx == 0 ? account.thisRankNo : account.lastRankNo;\n        \n        for (let i = 0; i < indicators.length; ++i) {\n            const transform = indicators[i]\n            transform.getChildByName(\"font\").color = cc.color(255, 255, 255);\n            //// const comp = transform.getComponent(cc.Sprite)\n            //// this._color.set(comp.color)\n            //// this._color.a = 255 / 2\n            //// comp.color = this._color\n            // transform.opacity = 255 / 2\n        }\n        if (indicators[idx]) {\n            const transform = indicators[idx]\n            transform.getChildByName(\"font\").color = cc.color(146, 151, 157);\n            // // const comp = indicators[idx].getComponent(Sprite)\n            // // this._color.set(comp.color)\n            // // this._color.a = 255\n            // // comp.color = this._color\n            // indicators[idx].opacity = 255\n        }\n    }\n}\n\n"]}