{"version":3,"sources":["assets/script/framework/manager/AudioMng.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAEA,oDAA0C;AAC1C,kDAA6C;AAC7C,uCAAsC;AAEtC;IAA8B,4BAAU;IACpC;QAAA,YACI,kBAAM,UAAU,CAAC,SAQpB;QACD,OAAO;QACP,WAAK,GAAW,IAAI,CAAC;QACrB,MAAM;QACN,SAAG,GAAW,IAAI,CAAC;QAXf,KAAI,CAAC,KAAK,GAAC,KAAI,CAAC,KAAK,CAAC,OAAO,EAAC,IAAI,CAAC,CAAA;QACnC,KAAI,CAAC,GAAG,GAAC,KAAI,CAAC,KAAK,CAAC,KAAK,EAAC,IAAI,CAAC,CAAA;QAE/B,KAAI,CAAC,GAAG,CAAC,OAAO,EAAC,KAAI,CAAC,KAAK,CAAC,CAAA;QAC5B,KAAI,CAAC,GAAG,CAAC,KAAK,EAAC,KAAI,CAAC,GAAG,CAAC,CAAA;QAExB,KAAI,CAAC,IAAI,EAAE,CAAA;;IACf,CAAC;IAKL,eAAC;AAAD,CAfA,AAeC,CAf6B,oBAAU,GAevC;AAfY,4BAAQ;AAiBV,QAAA,QAAQ,GAAa,IAAI,QAAQ,EAAE,CAAC;AAC/C,cAAE,CAAC,GAAG,CAAC,gBAAQ,EAAE,UAAU,CAAC,CAAC;AAE7B;IAMI;QAJA,YAAO,GAAQ,EAAE,CAAC;QACX,gBAAW,GAAG,CAAC,CAAA;QACf,aAAQ,GAAG,CAAC,CAAA;QAGf,cAAE,CAAC,QAAQ,CAAC,gBAAgB,EAAC,IAAI,CAAC,mBAAmB,EAAC,IAAI,CAAC,CAAC;QAC5D,cAAE,CAAC,QAAQ,CAAC,cAAc,EAAC,IAAI,CAAC,iBAAiB,EAAC,IAAI,CAAC,CAAC;QAExD,IAAM,KAAK,GAAG,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,GAAG,CAAA;QAClD,IAAM,MAAM,GAAG,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,GAAG,CAAA;QACpD,IAAI,CAAC,WAAW,GAAG,MAAM,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;QACxC,IAAI,CAAC,QAAQ,GAAG,KAAK,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;IACxC,CAAC;IAED,QAAQ;IACD,oBAAW,GAAlB;QACI,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAChB,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,EAAE,CAAC;SAClC;QACD,OAAO,IAAI,CAAC,QAAQ,CAAC;IACzB,CAAC;IAED,sCAAmB,GAAnB,UAAoB,CAAC,EAAE,CAAC,EAAE,OAAiB;QACvC,IAAI,CAAC,GAAI,cAAE,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;QACvC,gBAAQ,CAAC,GAAG,CAAC,OAAO,EAAC,CAAC,CAAC,CAAA;QACvB,gBAAQ,CAAC,IAAI,EAAE,CAAC;IACpB,CAAC;IAED,oCAAiB,GAAjB,UAAkB,CAAC,EAAE,CAAC,EAAE,OAAiB;QACrC,gBAAQ,CAAC,GAAG,CAAC,KAAK,EAAC,CAAC,CAAC,CAAA;QACrB,IAAG,CAAC,EAAC;YACD,IAAI,CAAC,OAAO,EAAE,CAAC;SAClB;aAAI;YACD,IAAI,CAAC,OAAO,EAAE,CAAC;SAClB;QACD,gBAAQ,CAAC,IAAI,EAAE,CAAC;IACpB,CAAC;IAGD,0BAAO,GAAP,UAAQ,SAAS,EAAE,EAAc;QAAd,mBAAA,EAAA,MAAc;QAC7B,IAAI,IAAI,GAAG,IAAI,CAAA;QACf,IAAG,gBAAQ,CAAC,KAAK,IAAE,KAAK,EAAC;YACrB,OAAM;SACT;QAED,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,GAAC,SAAS,EAAE,EAAE,CAAC,KAAK,EAAE,UAAS,GAAG,EAAE,GAAG;YAC9D,IAAI,GAAG,EAAE;gBACL,SAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACb,OAAO;aACV;YACD,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,GAAC,SAAS,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;YAC1D,IAAI,CAAC,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAC,KAAK,EAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;YAC5D,IAAG,EAAE,EAAC;gBACF,EAAE,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;aACxC;QACL,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IAClB,CAAC;IAED,0BAAO,GAAP;QACI,IAAI,CAAC,GAAI,cAAE,CAAC,QAAQ,CAAC,cAAc,CAAC,CAAC;QACrC,IAAG,CAAC,EAAC;YACD,IAAI,CAAC,OAAO,EAAE,CAAC;SAClB;IACL,CAAC;IAED,0BAAO,GAAP,UAAQ,SAAc;QAAd,0BAAA,EAAA,gBAAc;QAClB,IAAI,IAAI,GAAG,IAAI,CAAA;QAEf,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,KAAK,EAAE,UAAS,GAAG,EAAE,GAAG;YACvD,IAAI,GAAG,EAAE;gBACL,SAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACb,OAAO;aACV;YACD,IAAI,GAAG,GAAG,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE,EAAE,CAAC,KAAK,CAAC,CAAC;YACnD,SAAS,GAAG,SAAS,IAAI,GAAG,CAAA;YAC5B,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,EAAC,IAAI,EAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;QACzE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;IAClB,CAAC;IAED,SAAS;IACT,gCAAa,GAAb,UAAc,GAAW;QACrB,IAAG,gBAAQ,CAAC,GAAG,IAAI,KAAK,EAAC;YACrB,OAAM;SACT;QAED,IAAI,IAAI,GAAG,IAAI,CAAA;QACf,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,GAAG,EAAE,GAAG;YAC3C,IAAI,CAAC,OAAO,EAAE,CAAC;YACN,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAC,IAAI,EAAC,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC;QACzE,CAAC,CAAC,CAAC;IACD,CAAC;IAED,SAAS;IACT,gCAAa,GAAb,UAAc,GAAW;QACrB,IAAI,IAAI,GAAG,IAAI,CAAA;QACf,IAAG,gBAAQ,CAAC,KAAK,IAAE,KAAK,EAAC;YACrB,OAAM;SACT;QACD,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,UAAU,GAAG,EAAE,GAAG;YAClC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,GAAG,EAAC,KAAK,EAAC,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,CAAC;QAC9D,CAAC,CAAC,CAAC;IACD,CAAC;IAED,0BAAO,GAAP;QACI,IAAI,IAAI,GAAG,IAAI,CAAA;QACf,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;IACrC,CAAC;IAED,2BAAQ,GAAR;QACI,EAAE,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC;IAC9B,CAAC;IAED,4BAAS,GAAT;QACI,EAAE,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;IAC/B,CAAC;IACL,eAAC;AAAD,CAtHA,AAsHC,IAAA;AAtHY,4BAAQ","file":"","sourceRoot":"/","sourcesContent":["import UIHelp from \"../ui/UIHelp\";\nimport VMBase from '../component/VMBase';\nimport {VM} from '../component/ViewModel';\nimport ISerialize from \"../model/ISerialize\";\nimport { Log } from \"../../utils/Log\";\n\nexport class AudioCnf extends ISerialize{\n    constructor() {\n        super(\"audiocnf\");\n        this.click=this.Query(\"click\",true)\n        this.bgm=this.Query(\"bgm\",true)\n\n        this.Set(\"click\",this.click)\n        this.Set(\"bgm\",this.bgm)\n\n        this.Save()\n    }\n    //点击的音效\n    click:boolean = true;\n    //背景音乐\n    bgm:boolean = true;\n}\n\nexport let audioCnf: AudioCnf = new AudioCnf();\nVM.add(audioCnf, 'audiocnf'); \n\nexport class AudioMng {\n    private static instance: AudioMng;\n    musicid: any = '';\n    public effectRatio = 1\n    public bgmRatio = 1\n\n    constructor() {\n        VM.bindPath(\"audiocnf.click\",this.onValueChangedClick,this);\n        VM.bindPath(\"audiocnf.bgm\",this.onValueChangedBGM,this);\n\n        const sound = localStorage.getItem('sound') || '1'\n        const effect = localStorage.getItem('effect') || '1'\n        this.effectRatio = effect == '1' ? 1 : 0\n        this.bgmRatio = sound == '1' ? 1 : 0\n    }\n\n    //获取这个单例\n    static getInstance() {\n        if (!this.instance) {\n            this.instance = new AudioMng();\n        }\n        return this.instance;\n    }\n\n    onValueChangedClick(n, o, pathArr: string[]) {\n        var b =  VM.getValue(\"audiocnf.click\");\n        audioCnf.Set(\"click\",n)\n        audioCnf.Save();\n    }\n\n    onValueChangedBGM(n, o, pathArr: string[]) {\n        audioCnf.Set(\"bgm\",n)\n        if(n){\n            this.playBGM();\n        }else{\n            this.stopBGM();\n        }\n        audioCnf.Save();\n    }\n\n\n    playSFX(audioclip, ct: number = 0){\n        let self = this\n        if(audioCnf.click==false){\n            return\n        }\n\n        cc.loader.loadRes(\"sounds/\"+audioclip, cc.Asset, function(err, ret) {\n            if (err) {\n                Log.log(err);\n                return;\n            }\n            let tem = cc.loader.getRes(\"sounds/\"+audioclip, cc.Asset);\n            var a = cc.audioEngine.play(tem,false,1 * self.effectRatio);\n            if(ct){\n                cc.audioEngine.setCurrentTime(a, ct);\n            }\n        }.bind(this));\n    }\n\n    initBgm(){\n        var b =  VM.getValue(\"audiocnf.bgm\");\n        if(b){\n            this.playBGM();\n        }\n    }\n\n    playBGM(audioclip=null){\n        let self = this\n\n        cc.loader.loadRes(\"sounds/bgm\", cc.Asset, function(err, ret) {\n            if (err) {\n                Log.log(err);\n                return;\n            }\n            let tem = cc.loader.getRes(\"sounds/bgm\", cc.Asset);\n            audioclip = audioclip || tem\n            self.stopBGM();\n            self.musicid = cc.audioEngine.play(audioclip,true,1 * self.bgmRatio);\n        }.bind(this));\n    }\n\n    //播放网络BGM\n    playOnlineBGM(url: string){\n        if(audioCnf.bgm == false){\n            return\n        }\n\n        var self = this\n        cc.loader.load(url, function (err, tex) {\n\t\t\tself.stopBGM();\n            self.musicid = cc.audioEngine.play(tex,true,1 * self.bgmRatio);\n\t\t});\n    }\n\n    //播放网络SFX\n    playOnlineSFX(url: string){\n        let self = this\n        if(audioCnf.click==false){\n            return\n        }\n        cc.loader.load(url, function (err, tex) {\n            cc.audioEngine.play(tex,false,1 * self.effectRatio); \n\t\t});\n    }\n\n    stopBGM(){\n        var self = this\n        cc.audioEngine.stop(self.musicid)\n    }\n\n    pauseAll(){\n        cc.audioEngine.pauseAll();\n    }\n\n    resumeAll(){\n        cc.audioEngine.resumeAll();\n    }\n}"]}