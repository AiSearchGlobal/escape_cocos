{"version":3,"sources":["assets/script/logic/ui/prefab/UIKiller.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import auto_killer from \"../../../data/autoui/prefab/auto_killer\";\nimport { AudioMng } from \"../../../framework/manager/AudioMng\";\nimport UIBase from \"../../../framework/ui/UIBase\";\nimport UIHelp from \"../../../framework/ui/UIHelp\";\nimport GameDataCenter from \"../../../userData/GameDataCenter\";\nimport { KILLER_ROADS, ROADS } from \"../../../userData/PlayerModel\";\nimport UIGameLayer from \"./UIGameLayer\";\n\nconst { ccclass, menu, property } = cc._decorator;\n\n@ccclass\n@menu(\"UI/prefab/UIKiller\")\nexport default class UIKiller extends UIBase {\n\tui: auto_killer = null;\n\n\tprotected static prefabUrl = \"killer\";\n\tprotected static className = \"UIKiller\";\n\n\tpublic static instance: UIKiller = null;\n\n\tprivate speed: number = 200;\n\tprivate speed1: number = 200;\n\tprivate speed2: number = 700;\n\tprivate killing: boolean = false;\n\tprivate roadList: any[] = [];\n\tprivate killRoomId: number = 0;\n\n\tonUILoad() {\n\t\tthis.ui = this.node.addComponent(auto_killer);\n\t\tUIKiller.instance = this;\n\t}\n\n\tonShow() {\n\n\t}\n\n\tonHide() {\n\n\t}\n\n\tonStart() {\n\n\t}\n\n\tresetUI() {\n\t\tthis.unscheduleAllCallbacks();\n\t\tthis.node.stopAllActions();\n\t\tthis.node.setPosition(UIGameLayer.instance.ui.pos12.position);\n\t}\n\n\tkill(roomId: number) {\n\t\tthis.killRoomId = roomId;\n\t\tthis.killing = true;\n\t\tthis.speed = this.speed1;\n\t\tthis.roadList = [];\n\t\tvar roads = KILLER_ROADS[roomId];\n\t\tvar pos0 = UIGameLayer.instance.ui[`pos${roads[0]}`].position;\n\t\tvar pos1 = UIGameLayer.instance.ui[`pos${roads[1]}`].position;\n\t\tvar pos2 = UIGameLayer.instance.ui[`pos${roads[2]}`].position;\n\t\tvar pos3 = UIGameLayer.instance.ui[`pos${roads[3]}`].position;\n\t\tvar d2 = pos1.sub(pos2).mag();\n\t\tvar d3 = pos2.sub(pos3).mag();\n\t\tvar spd = (d2 + d3) / 4;\n\t\tvar p1 = { t: 0, p: pos0 };\n\t\tvar p2 = { t: 2, p: pos1 };\n\t\tvar p3 = { t: d2 / spd, p: pos2 };\n\t\tvar p4 = { t: d3 / spd, p: pos3 };\n\t\tvar p5 = { t: 2, p: UIGameLayer.instance.ui[`kill_${roomId}`].position };\n\t\tthis.roadList = [p1, p2, p3, p4, p5];\n\n\t\t// for(let index of KILLER_ROADS[roomId]){\n\t\t// \tlet node: cc.Node = UIGameLayer.instance.ui[`pos${index}`];\n\t\t// \tthis.roadList.push(node.position);\n\t\t// }\n\t\t// this.roadList.push(UIGameLayer.instance.ui[`kill_${roomId}`].position);\n\n\t\tvar list = [].concat(this.roadList);\n\t\tthis.move(list, false);\n\t}\n\n\tmoveBack() {\n\t\tthis.killing = false;\n\t\tthis.speed = this.speed2;\n\t\tthis.roadList.reverse();\n\t\tvar list = [].concat(this.roadList);\n\t\tthis.move(list, true);\n\t}\n\n\tmove(list: any[], isBack: boolean) {\n\t\tif (list.length <= 0) {\n\t\t\tif (this.killing) {\n\t\t\t\tthis.ui.sp_killer.getComponent(sp.Skeleton).animation = \"attack\";\n\t\t\t\tAudioMng.getInstance().playSFX(\"kan\");\n\t\t\t\tthis.scheduleOnce(() => {\n\t\t\t\t\tAudioMng.getInstance().playSFX(\"jianshe\");\n\t\t\t\t}, 0.4);\n\t\t\t\tthis.scheduleOnce(() => {\n\t\t\t\t\tGameDataCenter.accountModel.players.forEach(element => {\n\t\t\t\t\t\tif (element.roomId == this.killRoomId) {\n\t\t\t\t\t\t\telement.destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.ui.sp_killer.getComponent(sp.Skeleton).animation = \"walk\";\n\t\t\t\t\tthis.moveBack();\n\t\t\t\t\tUIGameLayer.instance.dropCoins(this.killRoomId);\n\t\t\t\t}, 2);\n\t\t\t}\n\t\t\tconsole.warn(\"杀手抵达房间\");\n\t\t\treturn\n\t\t}\n\t\tthis.ui.sp_killer.scaleX = this.node.x > list[0].p.x ? 1 : -1;\n\t\tvar dis = this.getDistance(this.node.position, list[0].p);\n\t\tvar t = isBack ? dis / this.speed : list[0].t;\n\t\tif (list.length == 1 && !isBack) {\n\t\t\tUIGameLayer.instance.openDoor(this.killRoomId);\n\t\t}\n\t\tcc.tween(this.node)\n\t\t\t.to(t, { position: list[0].p })\n\t\t\t.call(() => {\n\t\t\t\tlist.splice(0, 1);\n\t\t\t\tthis.move(list, isBack);\n\t\t\t})\n\t\t\t.start();\n\t}\n\n\t// 距离\n\tgetDistance(start, end) {\n\t\tvar pos = cc.v2(start.x - end.x, start.y - end.y);\n\t\tvar dis = Math.sqrt(pos.x * pos.x + pos.y * pos.y);\n\t\treturn dis;\n\t}\n\n\tonClose() {\n\t\tUIHelp.CloseUI(UIKiller);\n\t}\n}"]}