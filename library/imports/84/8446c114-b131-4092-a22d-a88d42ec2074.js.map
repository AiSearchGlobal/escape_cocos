{"version":3,"sources":["assets/script/framework/component/VMState.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nimport { VM } from './ViewModel';\nimport VMBase from './VMBase';\n\nconst {ccclass, property,menu,help} = cc._decorator;\n\n/**比较条件 */\nenum CONDITION{\n    \"==\", //正常计算，比较 等于\n    \"!=\", //正常计算，比较 不等于\n    \">\",  //正常计算，比较>\n    \">=\", //正常计算，比较>=\n    \"<\",  //正常计算，比较<\n    \"<=\", // 正常计算，比较>=\n    \"range\" //计算在范围内\n}\n\n\nenum ACTION {\n    NODE_ACTIVE, //满足条件 的 节点激活 ，不满足的不激活\n    NODE_VISIBLE, //满足条件 的节点显示，不满足的不显示\n    NODE_OPACITY,  //满足条件的节点改变不透明度，不满足的还原255\n    NODE_COLOR, //满足条件的节点改变颜色，不满足的恢复白色\n    COMPONENT_CUSTOM, //自定义控制组件模式\n}\n\n\nenum CHILD_MODE_TYPE {\n    NODE_INDEX,\n    NODE_NAME\n}\n\n\n/**\n * [VM-State]\n * 监听数值状态,根据数值条件设置节点是否激活\n */\n@ccclass\n@menu('ModelViewer/VM-State (VM状态控制)')\n@help('https://github.com/wsssheep/cocos_creator_mvvm_tools/blob/master/docs/VMState.md')\nexport default class VMState extends VMBase {\n\n    @property\n    watchPath:string = \"\";\n\n    @property({\n        tooltip:'遍历子节点,根据子节点的名字或名字转换为值，判断值满足条件 来激活'\n    })\n    foreachChildMode:boolean = false;\n\n    @property({\n        type:cc.Enum(CONDITION),\n    })\n    condition:CONDITION = CONDITION[\"==\"];\n\n    @property({\n        type:cc.Enum(CHILD_MODE_TYPE),\n        tooltip:'遍历子节点,根据子节点的名字转换为值，判断值满足条件 来激活',\n        visible:function(){return this.foreachChildMode === true}\n    })\n    foreachChildType:CHILD_MODE_TYPE = CHILD_MODE_TYPE.NODE_INDEX;\n    \n    @property({\n        displayName:'Value: a',\n        visible:function(){return this.foreachChildMode === false }\n    })\n    valueA:number = 0;\n\n    @property({\n        displayName:'Value: b',\n        visible:function(){return this.foreachChildMode === false && this.condition ===  CONDITION.range }\n    })\n    valueB:number = 0;\n\n\n    @property({\n        type:cc.Enum(ACTION),\n        tooltip:'一旦满足条件就对节点执行操作'\n    })\n    valueAction:ACTION =  ACTION.NODE_ACTIVE;\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.NODE_OPACITY},\n        range:[0,255],\n        type:cc.Integer,\n        displayName:'Action Opacity'\n    })\n    valueActionOpacity:number = 0;\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.NODE_COLOR},\n        displayName:'Action Color'\n    })\n    valueActionColor:cc.Color = cc.color(155,155,155);\n\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.COMPONENT_CUSTOM},\n        displayName:'Component Name'\n    })\n    valueComponentName:string = '';\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.COMPONENT_CUSTOM},\n        displayName:'Component Property'\n    })\n    valueComponentProperty:string = '';\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.COMPONENT_CUSTOM},\n        displayName:'Default Value'\n    })\n    valueComponentDefaultValue:string = '';\n\n    @property({\n        visible:function(){return this.valueAction === ACTION.COMPONENT_CUSTOM},\n        displayName:'Action Value'\n    })\n    valueComponentActionValue:string  = '';\n\n    @property({\n        type:[cc.Node],\n        tooltip:'需要执行条件的节点，如果不填写则默认会执行本节点以及本节点的所有子节点 的状态'\n    })\n    watchNodes:cc.Node[] = [];\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        super.onLoad();\n        //如果数组里没有监听值，那么默认把所有子节点给监听了\n        if(this.watchNodes.length == 0){\n            if(this.valueAction !== ACTION.NODE_ACTIVE && this.foreachChildMode === false ){\n                this.watchNodes.push(this.node);\n            }\n            this.watchNodes = this.watchNodes.concat(this.node.children);\n        }\n    }\n\n    start () {\n        if(this.enabled){\n            this.onValueInit();\n        }\n    }\n\n    //当值初始化时\n    protected onValueInit(){\n        let value =  VM.getValue(this.watchPath);\n        this.checkNodeFromValue(value);\n    }\n\n    //当值被改变时\n    protected onValueChanged(newVar:any,oldVar:any,pathArr:any[]){\n        this.checkNodeFromValue(newVar);\n    }\n\n    //检查节点值更新\n    private checkNodeFromValue(value){\n        if(this.foreachChildMode){\n            this.watchNodes.forEach((node,index)=>{\n                let v  = (this.foreachChildType === CHILD_MODE_TYPE.NODE_INDEX)?index:node.name;\n                let check =  this.conditionCheck(value,v);\n                 //cc.log('遍历模式',value,node.name,check);\n                this.setNodeState(node,check);\n            })\n        }else{\n            let check = this.conditionCheck(value,this.valueA,this.valueB);\n            this.setNodesStates(check);\n        }\n    }\n\n    //更新 多个节点 的 状态\n    private setNodesStates(checkState?:boolean){\n        let nodes = this.watchNodes;\n        let check = checkState;\n        nodes.forEach((node)=>{\n            this.setNodeState(node,check);\n        })\n    }\n\n    /**更新单个节点的状态 */\n    private setNodeState(node:cc.Node,checkState?:boolean){\n        let n = this.valueAction;\n        let check = checkState;\n        let a = ACTION;\n        switch (n) {\n            case a.NODE_ACTIVE: node.active = check?true:false;  break; \n            case a.NODE_VISIBLE: node.opacity = check?255:0;  break;\n            case a.NODE_COLOR: node.color = check?this.valueActionColor:cc.color(255,255,255); break;\n            case a.NODE_OPACITY: node.opacity = check?this.valueActionOpacity:255;  break;\n\n            case a.COMPONENT_CUSTOM:\n                let comp =  node.getComponent(this.valueComponentName);\n                if(comp == null)return;\n                if(this.valueComponentProperty in comp){\n                    comp[this.valueComponentProperty] = check?this.valueComponentActionValue:this.valueComponentDefaultValue;\n                }\n            break;\n        \n            default:\n                break;\n        }\n    }\n\n\n    /**条件检查 */\n    private conditionCheck(v,a,b?):boolean{\n        let cod = CONDITION;\n        switch (this.condition) {\n            case cod[\"==\"]:\n                if(v == a)return true;\n                break;\n            case cod[\"!=\"]:\n                if(v != a)return true;\n                break;\n            case cod[\"<\"]:\n                if(v < a)return true;\n                break;\n            case cod[\">\"]:\n                if(v > a)return true;\n                break;\n            case cod[\">=\"]:\n                if(v >= a)return true;\n                break;\n            case cod[\"<\"]:\n                if(v < a)return true;\n                break;\n            case cod[\"<=\"]:\n                if(v <= a)return true;\n                break;\n            case cod[\"range\"]:\n                if(v >=a && v<=b)return true;\n                break;\n        \n            default:\n                break;\n        }\n\n        return false;\n    }\n\n\n    // update (dt) {}\n}\n"]}