{"version":3,"sources":["assets/script/framework/component/VMTurntable.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import UIBase from \"../ui/UIBase\";\nimport { Utils } from \"../../utils/Utils\";\n\nconst { ccclass, property, menu, executeInEditMode, help } = cc._decorator;\n\n/**\n *  [VM-Turntable]\n *  调用VMTurntable.instance.roll();\n *  转盘转动过程中自动生成屏蔽层，结束后删除屏蔽层\n */\n@ccclass\n// @executeInEditMode\n@menu('ModelViewer/VM-Turntable(转盘动画)')\n// @help('https://github.com/wsssheep/cocos_creator_mvvm_tools/blob/master/docs/VMLogin.md')\nexport default class VMTurntable extends UIBase {\n    @property({ type: cc.Node, displayName: \"需要转动的node\" })\n    nodeRoll: cc.Node = null;\n\n    @property({ type: cc.Integer, displayName: \"转盘拆分份数\" })\n    scores: number = 8;\n\n    @property({ type: cc.Integer, displayName: \"偏移份数\", tooltip: \"结果显示顺时针增加相应份数\" })\n    skew: number = 0;\n\n    @property({ type: cc.Integer, displayName: \"转过最少圈数\" })\n    qMin: number = 4;\n\n    @property({ type: cc.Integer, displayName: \"转过最多圈数\" })\n    qMax: number = 8;\n\n    @property({ type: cc.Integer, displayName: \"延迟回掉x秒\" })\n    delayTiem: number = 0;\n\n    @property({displayName: \"所停位置是否有偏移浮动\", tooltip: \"指针所停位置离奖区是否有偏移浮动\" })\n    hasOffset: Boolean = false;\n\n    public static instance: VMTurntable;\n\n    onUILoad() {\n        VMTurntable.instance = this;\n    }\n\n    onShow() {\n    }\n\n    onStart() {\n    }\n\n    /**\n     * \n     * @param type 要停止的份数（1-总份数）\n     * @param callback 转盘停止后的回掉\n     */\n    roll(type: number, callback?: Function) {\n        var _modelNode: cc.Node = new cc.Node(\"xxx\");\n\t\t_modelNode.anchorX = 0;\n\t\t_modelNode.anchorY = 0;\n        _modelNode.width = cc.winSize.width;\n        _modelNode.height = cc.winSize.height;\n        _modelNode.addComponent(cc.BlockInputEvents);\n\t\t_modelNode.parent = cc.director.getScene();\n\t\t_modelNode.zIndex = 888;\n\n        var totalRotate = this.getRotationLong(type);//获取总长度\n        this.nodeRoll.rotation = 0;\n\n        cc.tween(this.nodeRoll)\n        .to(4, {angle: -totalRotate}, {easing: 'expoOut'})\n        .delay(this.delayTiem)\n        .call(function () {\n            _modelNode.destroy();\n            callback && callback();\n        }.bind(this))\n        .start();\n    }\n\n    /**\n     * 总的旋转角度\n     * @param awardPosition 奖品所在奖区\n     * @return 总的旋转角度\n     */\n    private getRotationLong(awardPosition: number): number {\n        var _q: number = 360 * (Math.floor(Math.random() * (this.qMax - this.qMin)) + this.qMin);//整圈长度\n        var _Skew: number = -(360 / this.scores) * this.skew;//第一个奖区起始点与0点位置的偏移比例\n        var _location: number = (360 / this.scores) * (this.scores - awardPosition + 1);//目标奖区的起始点\n        var _offset = Utils.random(0, 360 / this.scores) / 2 * (Utils.random(0, 2) == 1 ? 1 : -1);\n\n        if(this.hasOffset){\n            return _q + _Skew + _location + _offset;\n        }else{\n            return _q + _Skew + _location;\n        }\n    }\n}\n"]}